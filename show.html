<!DOCTYPE html>
<html>
<head>
	<title>TagMap show</title>

	<link rel="stylesheet" href="libs/leaflet.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="libs/leaflet.ie.css" /><![endif]-->
	<link rel="stylesheet" href="leaflet.draw.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="leaflet.draw.ie.css" /><![endif]-->

	<script src="libs/leaflet-src.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.0.js"></script>
</head>
<body>

    <table> <tr>
            <td>
                <div id="map" style="width: 500px; height: 500px; border: 1px solid #ccc"></div>
            </td>
            <td>
                <div id="divs">
                     <button id="display">SÃ¸g</button> 
                     <button id="clear">Rens kort</button>
                 </div>
                <div id="info" style="width: 500px; height: 500px; border: 1px solid #ccc">
                </div>
            </td>
        </tr>
    </table>

    <script src="TagMap.js"></script>
    <script type="text/javascript">
    
	function createTagSelector(data){
	    data.splice(data.length-1,1);
	    referenceTags = new Array();
	    referenceTags.push("");
	    $.each(data, function(index, value){
		//Splitting the tags by ";", which is used with multiple tags
		var tags = value.tags.split(";");
		//Iterating through the tags for the data element
		$.each(tags, function(counter, item){
		    //If tag is not recorded, add it to the reference arr
		    if($.inArray(item, referenceTags) === -1){
			referenceTags.push(item);
		    }
		});
	    });
	    createSelectList(referenceTags);
	 }

	//Creates the select list using the created list of tags
	function createSelectList(referenceTags){
	    var s = $("<select id=\"tagsQuery\" />");
	    $.each(referenceTags, function(index, value){
		$("<option />", {value: value, text: value}).appendTo(s);
	    });
	    $("#divs").append(s);
	}
	
	$(document).ready( function() {
		//Receiving data
		$.ajax({
 			url: 'http://www.politietsregisterblade.dk/api/1/?type=mapdata',
		 	dataType: "jsonp",
		 	success: function(data){
		     		createTagSelector(data);
		 	}
		});
	});
    
    var tagmap = new TagMap({
        api: "api.php", //PolleAPI
        content: "content_da",
        mapDiv: 'map',
        infoDiv: 'info',
        baseMaps: {
            "Historisk atlas": new L.TileLayer('http://tile.historiskatlas.dk/54/{z}/{x}/{y}.jpg'),
            "OSM": new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
            "cloudmade": new L.TileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png')
        },
        tagConfig : [
        {
            name: "default",
            style: {
                radius: 8,
                fillColor: "#ffcc47",
                color: "#ff0000",
                weight: 5,
                opacity: 1,
                fillOpacity: 0.8
                }
        },
        {
            name: "mwp",
            style: {
                radius: 8,
                fillColor: "#aacc47",
                color: "#aaaa00",
                weight: 5,
                opacity: 1,
                fillOpacity: 0.8
                }
        },





  
      ],
       lat: 55.63405,
       lng: 12.59938,
       zoom: 14
    });

    $('#display').on('click', function () {
        tagmap.show( $('#tagsQuery').val() );
    });
    $('#clear').on('click', function () { tagmap.clear(); });
    </script>
</body>
</html>
