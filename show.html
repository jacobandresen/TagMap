<!DOCTYPE html>
<html>
<head>
	<title>TagMap show</title>

        <meta charset="UTF-8">
	<link rel="stylesheet" href="libs/leaflet.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="libs/leaflet.ie.css" /><![endif]-->
	<link rel="stylesheet" href="leaflet.draw.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="leaflet.draw.ie.css" /><![endif]-->

	<script src="libs/leaflet-src.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.0.js"></script>
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
        <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>        
</head>
<body>

    <table width="100%"> 
        <tr>
            <td>
                <div id="divs">
                     <button id="display">Søg</button> 
                     <button id="clear">Rens kort</button>
                 </div>
            </td>
        </tr>
        <tr>
            <td>
                <div id="map" style="height: 500px; border: 1px solid #ccc"></div>
                <div id="info" style="width: 500px; height: 500px; border: 1px solid #ccc">
                </div>
            </td>
        </tr>
    </table>
    <h2>Datovælger</h2>
    <div id="dateSliderText"></div>
    <div id="dateSlider"></div>
    <script src="TagMap.js"></script>
    <script type="text/javascript">
    
    var tagmap = new TagMap({
        api: "http://www.politietsregisterblade.dk/api/",
        content: "content_da",
        mapDiv: 'map',
        infoDiv: 'info',
        tagSelectorDiv: 'divs',
        filter: 'selectlist',
        showLayerControls: false,
        baseMaps: {
           /* "Historisk atlas": new L.TileLayer('http://tile.historiskatlas.dk/54/{z}/{x}/{y}.jpg'),
            "OSM": new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),*/
            "København 2013": new L.TileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png',{zIndex: 0})
        },
        overlayMaps: {
            "København 1940": new L.TileLayer('http://www.politietsregisterblade.dk/kortdata/1/{z}/{x}/{y}.png',{ tms:true, zIndex:1 }), 
            "Sjælland 1940": new L.TileLayer('http://www.politietsregisterblade.dk/kortdata/2/{z}/{x}/{y}.png',{ tms:true, zIndex:2 })                 
        },
        tagConfig : [
        {
            name: "default",
            style: {
                radius: 8,
                fillColor: "#ffcc47",
                color: "#ff0000",
                weight: 5,
                opacity: 1,
                fillOpacity: 0.8
                }
        },
        {
            name: "jøde",
            style: {
                radius: 8,
                fillColor: "green",
                color: "green",
                weight: 5,
                opacity: 1,
                fillOpacity: 0.8
                }
        },
        {
            name: "hjælper",
            style: {
                radius: 8,
                fillColor: "blue",
                color: "blue",
                weight: 5,
                opacity: 1,
                fillOpacity: 0.8
                }
        },        
        {
            name: "socialtjeneste",
            style: {
                radius: 8,
                fillColor: "yellow",
                color: "yellow",
                weight: 5,
                opacity: 1,
                fillOpacity: 0.8
                }
        },           
      ],
       lat: 55.67899,
       lng: 12.57522,
       zoom: 12,
        predefinedFilterBoxes: [
            {
                name: 'Jøderazzia',
                tagName: 'jøderazzia',
                selected: false
            },
            {
                name: 'Hjælpere',
                tagName: 'hjælper',
                selected: false
            },
            {
                name: 'Socialtjenesten',
                tagName: 'socialtjeneste',
                selected: false
            }   
        ]       
    });
    
    //TagString used to retrieve the date tags selected with the date slider
    var tagStr = "";
    
    //Updates the tagString based on the selected slider values, which are converted to
    //date tags. The chosen dates are displayed in #dateSliderText
    var updateDateInfo = function(){
        var values = $("#dateSlider").slider("values");
        tagStr = "";
        
        $.each(sliderToDate.slice(values[0],values[1]), function(index,value){
            tagStr = tagStr + value + ";";
        });
        tagStr = tagStr.substring(0, tagStr.length-1);
        
        $("#dateSliderText").html(sliderToDate[values[0]] + "-" + sliderToDate[values[1]]);
    };
    
    //Updates the tags and redraws the markers having the selected date tags
    var updateFilter = function(){
        updateDateInfo();
        tagmap.show(tagStr, 'OR');
    }
    
    //Creating the slider
    $( "#dateSlider" ).slider({
      orientation: "horizontal",
      range: true,
      max: 32,
      values: [0, 5],
      slide: updateDateInfo,
      change: updateFilter
    });  
    
    //Date array used to convert slider values to dates 
    //(the array position is simply used to convert the slider value to a date)
    var sliderToDate = [
            "28/9",
            "29/9",
            "30/9",
            "1/10",
            "2/10",
            "3/10",
            "4/10",
            "5/10",
            "6/10",
            "7/10",
            "8/10",
            "9/10",
            "10/10",
            "11/10",
            "12/10",
            "13/10",
            "14/10",
            "15/10",
            "16/10",
            "17/10",
            "18/10",
            "19/10",
            "20/10",
            "21/10",
            "22/10",
            "23/10",
            "24/10",
            "25/10",
            "26/10",
            "27/10",
            "28/10",
            "29/10",
            "30/10"
    ];
    </script>
</body>
</html>
